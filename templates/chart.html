{% extends "index_layout.html" %}

{% block body%}
    <div class="row">
        <div class="col-lg-2"></div>
        <div class="col-lg-8">
          <canvas id="myChart" width="200" height="100"></canvas>
          <input data-slider-value="0" id="ex4" type="text"/>
        </div>
        <div class="col-lg-2"></div>
    </div>
    <script>

        $("#ex4").slider({
          ticks: [0, 1, 2, 3, 4],
          ticks_labels: ["Now", "Hours", "Days", "Weeks", "Months"],
          value: 0,
          step:1

        });

        $("#ex4").on("change", function(val){
            
        });

        var data = {{ base_chart_data }}
        var dataParams = ["TEMPERATURE", "PRESSURE", "HUMIDITY"];
        var dataColors = ["red", "green", "blue"];
        var timeFormat = true;
        function getGraphUpdate(){
            if (timeFormat){
              var lastData = data.TEMPERATURE;
              $.ajax({
                  url: "chart?last="+lastData[lastData.length-1].x,
                  success: function(result){
                    var nd = result;
                    for (j in dataParams){
                      for (i in nd[dataParams[j]]){
                        data[dataParams[j]].push(nd[dataParams[j]][i]);
                      }
                    }
                    window.myLine.update();
                  }
              });
            }
        }
        var timeFormat = 'DD/MM/YYYY';

        var config = {
            type:    'line',
            data:    {
                datasets: [
                    {
                        label: "Temperature",
                        data: data.TEMPERATURE,
                        borderColor: dataColors[0],
                        yAxisID: "y0",
                        fill: false
                    },
                    {
                        label: "Pressure",
                        data: data.PRESSURE,
                        borderColor: dataColors[1],
                        yAxisID: "y1",
                        fill: false
                    },
                    {
                        label: "Humidity",
                        data: data.HUMIDITY,
                        borderColor: dataColors[2],
                        yAxisID: "y2",
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                title:      {
                    display: true,
                    text:    "Weather station"
                },
                scales:     {
                    xAxes: [{
                        type:       "time",
                        scaleLabel: {
                            display:     true,
                            labelString: 'Date'
                        }
                    }],
                    yAxes: [{
                        id: "y0",
                        position: "left",
                        // padding: 100,
                        ticks: {
                          suggestedMax: 30,
                          suggestedMin: 15,
                          // padding: 100,
                          fontColor: dataColors[0],
                        },
                        scaleLabel: {
                            display:     true,
                            labelString: 'Â°C'
                        }
                    },
                    {
                        id: "y1",
                        position: "right",
                        ticks: {
                          fontColor: dataColors[1],
                        },
                        scaleLabel: {
                            display:     true,
                            labelString: 'hPa'
                        }
                    },
                    {
                        id: "y2",
                        position: "right",
                        ticks: {
                          fontColor: dataColors[2],
                        },
                        scaleLabel: {
                            display:     true,
                            labelString: '%'
                        }
                    }]
                },
              //   layout: {
              //     padding: {
              //         left: 50,
              //         right: 50,
              //         top: 50,
              //         bottom: 50
              //     }
              // }
            }
        };

        window.onload = function () {
            var ctx       = document.getElementById("myChart").getContext("2d");
            window.myLine = new Chart(ctx, config);
        };



        setInterval(getGraphUpdate,300000);

    </script>
{% endblock %}
